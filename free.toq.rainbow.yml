id: free.toq.rainbow
runtime: org.gnome.Platform
runtime-version: "49"
sdk: org.gnome.Sdk
command: toq-rainbow

finish-args:
  - --share=ipc                                           # DBus-Kommunikation oder IPC intern
  - --socket=fallback-x11                                 # X11-Fallback
  - --socket=wayland                                      # Wayland...
  - --socket=session-bus                                  # Session-Bus für KDE & Flatpak-GNOME
  - --socket=system-bus                                   # für systemd-Inhibit 
  - --device=dri                                          # GPU...
  - --talk-name=org.freedesktop.login1                    # systemd-Inhibit
  - --talk-name=org.freedesktop.ScreenSaver               # anscheinend nicht in Flatpak zulässig!
#  - --talk-name=org.kde.Solid.PowerManagement.PolicyAgent # KDE Inhibit
#  - --filesystem=home                                     # Zugriff auf USER-Daten
#  - --env=LC_ALL=C.UTF-8                                  # Lokalisierung
#  - --own-name=org.freedesktop.ScreenSaver                # notwendig für DBus-Objekt unter diesem Namen
#  - --own-name=free.toq.rainbow                           # für App-DBus-Name

modules:
  - name: toq-rainbow
    buildsystem: simple
    build-commands:
      # ----- Erstelle Verzeichnis‑Struktur -----
      - mkdir -p _build/bin _build/share/locale/en_US/LC_MESSAGES _build/share/applications _build/share/icons/hicolor/scalable/apps _build/share/icons/hicolor/128x128/apps _build//share/screenshots

      # ----- Resourcesn kompilieren -----
      - glib-compile-resources src/resources.xml --sourcedir=data/icons/ --generate-source --target=src/free.toq.rainbow.gresource.c 

      # ----- Kompilieren der Anwendung -----
      - gcc $(pkg-config --cflags gtk4 libadwaita-1 dbus-1) -o _build/bin/toq-rainbow src/main.c src/free.toq.rainbow.gresource.c $(pkg-config --libs gtk4 libadwaita-1 dbus-1)

      # ----- Erstellen der .po‑Datei -----
      - msgfmt src/po/en_US.po --output-file=_build/share/locale/en_US/LC_MESSAGES/toq-rainbow.mo

      # ----- Installation
      - install -D -m 0755 _build/bin/toq-rainbow /app/bin/toq-rainbow
      - install -D -m 0644 packaging/free.toq.rainbow.desktop /app/share/applications/free.toq.rainbow.desktop
      - install -D -m 0644 packaging/free.toq.rainbow.svg /app/share/icons/hicolor/scalable/apps/free.toq.rainbow.png
      - install -D -m 0644 packaging/free.toq.rainbow.png /app/share/icons/hicolor/128x128/apps/free.toq.rainbow.png
      - install -D -m 0644 packaging/free.toq.rainbow.metainfo.xml /app/share/metainfo/free.toq.rainbow.metainfo.xml
      - install -D -m 0644 packaging/rainbow_preview_img1.png /app/share/screenshots/rainbow_preview_img1.png
      - install -D -m 0644 _build/share/locale/en_US/LC_MESSAGES/toq-rainbow.mo /app/share/locale/en_US/LC_MESSAGES/toq-rainbow.mo

    sources:
      - type: dir
        path: .
